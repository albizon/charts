language: minimal

before_install:
  - curl -L https://git.io/get_helm.sh | bash
  - helm init --client-only

jobs:
  include:
    - stage: build-dev
      if: branch =~ dev-
      script:
        - git clone -b gh-pages https://github.com/albizon/charts pages 
	- mkdir -p files-to-gh-pages/stable
        - mkdir -p files-to-gh-pages/dev   
        - cp -r	pages/stable files-to-gh-pages
        - cp -r pages/dev files-to-gh-pages
        - echo $(pwd)
        - bash ./build-dev.sh
        - cd files-to-gh-pages/dev
        - helm repo index .
        - ls -ltr
    - stage: build-stable
      if: branch = master
      script:
        - git clone -b gh-pages https://github.com/albizon/charts pages
        - mkdir -p files-to-gh-pages/stable
        - mkdir -p files-to-gh-pages/dev
        - cp -r pages/stable files-to-gh-pages
        - cp -r	pages/dev files-to-gh-pages
        - echo $(pwd)
        - bash ./helm-packages.sh
        - cd files-to-gh-pages/stable
        - helm repo index .
        - ls -ltr
deploy:
  provider: pages
  github_token: $GITHUB_TOKEN
  local_dir: files-to-gh-pages
  target_branch: gh-pages
  verbose: true
  skip_cleanup: true
  keep_history: true
